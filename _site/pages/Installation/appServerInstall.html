<h1 id="application-server">Application Server</h1>

<p>The Application Server (or Blinky-Lite Box) requires <a href="https://www.mongodb.com/atlas/database">MongoDB</a> and <a href="https://mqtt.org">MQTT</a> as services which can be difficult to install so we have bundled the Blinky-Lite Box in a <a href="https://hub.docker.com/r/blinkylite/blinky-lite-box">Docker container</a>. Then we have developed Docker Compose yaml files for retrieving and starting the Blinky-Lite Box with all the required services. The <a href="https://docs.docker.com/engine/install">Docker Engine</a> is easily installed on Linux systems. For operating systems other than Linux you will need to use <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a>.</p>

<h3 id="usage">Usage</h3>

<p>Download zipped  blinky-lite-box <a href="https://github.com/Blinky-Lite/docker-templates/raw/master/blinky-box-docker.zip">docker compose file</a> template. The file will unzip into a directory. Enter the directory and edit the .env file with settings of your choosing.</p>

<h4 id="environment-variables">Environment Variables</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">BLINKYLITE_PASSWORD</code> - password for the MongoDB database</li>
  <li><code class="language-plaintext highlighter-rouge">JWTKEYSECRET</code> - key for the JWT security</li>
  <li><code class="language-plaintext highlighter-rouge">NEXMOAPIKEY</code> - Vonnage sms API key<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></li>
  <li><code class="language-plaintext highlighter-rouge">NEXMOAPISECRET</code> - Vonnage sms API secret<sup id="fnref:1:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></li>
  <li><code class="language-plaintext highlighter-rouge">MAXDBSIZE</code> - Maximum size of the MongoDB database in bytes</li>
  <li><code class="language-plaintext highlighter-rouge">BLINKYPORT</code> - IP port of the Blinky-Lite Web application</li>
  <li><code class="language-plaintext highlighter-rouge">EXPRESSPORT</code> - IP port of the MongoDB Express Web application</li>
  <li><code class="language-plaintext highlighter-rouge">MQTTPORT</code> - IP port of MQTT communications which is usually set to 1883</li>
  <li><code class="language-plaintext highlighter-rouge">TWOFA</code> - Two factor authentication flag, 0 for disable, 1 for enable</li>
  <li><code class="language-plaintext highlighter-rouge">ENABLEARCHIVE</code> - Enable archiving flag. 0 for disable, 1 for enable</li>
</ul>

<h4 id="starting-the-containers">Starting the containers</h4>

<p>From a command line, enter the blinky-box-docker directory that you just unzipped and enter:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose <span class="nt">-f</span> blinky-box.yaml up <span class="nt">-d</span>
</code></pre></div></div>

<p>On the first run, Docker will have to pull a number of images that will take some time. Once the containers have spun up you can see the Blinky-Lite application and the database application on localhost on the ports specified in the .env file.</p>

<h4 id="adding-mqtt-passwords">Adding MQTT Passwords</h4>
<p>The script <code class="language-plaintext highlighter-rouge">add-mqtt-pw.sh</code> can be used for adding  mqtt credentials. The usage is:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./add-mqtt-pw.sh &lt;username&gt; &lt;password&gt;
</code></pre></div></div>

<p>This script will restart the MQTT container to load the new credentials.</p>

<p>To remove passwords, edit the <code class="language-plaintext highlighter-rouge">pwfile</code> in the <code class="language-plaintext highlighter-rouge">mqtt-auth</code> folder and then restart the mqtt container with the <code class="language-plaintext highlighter-rouge">restart-mqtt.sh</code> script.  To restart the MQTT container, go to a command line in the <code class="language-plaintext highlighter-rouge">blinky-box-docker</code> directory and enter:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./restart-mqtt-pw.sh
</code></pre></div></div>

<h4 id="adding-mqtt-access-control-list-acl-rules">Adding MQTT Access Control List (ACL) Rules</h4>

<p>In the <code class="language-plaintext highlighter-rouge">mqtt-auth</code> folder, edit the <code class="language-plaintext highlighter-rouge">aclfile</code> file. There are examples already in place. After editing the file, restart the mqtt container with the <code class="language-plaintext highlighter-rouge">restart-mqtt.sh</code> script as descirbed above.</p>

<h2 id="customization">Customization</h2>
<p>Blinky-Lite is fully customize-able. The home page of a Blinky-Lite box is a static web page the and is defined in the <code class="language-plaintext highlighter-rouge">index.html</code> file and the <code class="language-plaintext highlighter-rouge">homepage</code> folder inside the <code class="language-plaintext highlighter-rouge">blinky-box-docker</code> directory.</p>

<p>Icons used in the Blinky-Lite applications can also be customized in the <code class="language-plaintext highlighter-rouge">blinky-lite-icons</code> folder inside the <code class="language-plaintext highlighter-rouge">blinky-box-docker</code> directory.</p>

<p>Most of the Blinky-Lite Box <a href="/pages/Overview/features.html#services">services</a> are customized by editing the database. This can easily be done with the Mongo-Express server that was installed in the Docker Compose file that can be accessed at <a href="http://localhost:8080">http://localhost:xxxxx</a> where xxxxx is defined by the <code class="language-plaintext highlighter-rouge">EXPRESSPORT</code> environmental variable. The username for the Mongo-Express server is <strong>admin</strong> and the password is defined by the <code class="language-plaintext highlighter-rouge">BLINKYLITE_PASSWORD</code> environmental variable.</p>

<h2 id="accessing-the-application-server">Accessing the Application Server</h2>
<p>The home page for the Application Server is at <a href="http://localhost:60427">http://localhost:yyyyy</a> where yyyyy is defined by the <code class="language-plaintext highlighter-rouge">BLINKYPORT</code> environmental variable. You can access the application index page at <a href="http://localhost:60427/myapps">http://localhost:yyyyy/myapps</a>. The Docker image comes loaded with an example user <strong>aeinstein</strong> with a password <strong>e=mcsquared</strong>. You should delete this example user after you have deployed the application server.</p>

<hr />
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Blinky-Lite uses Nexmo or <a href="https://www.vonage.com/communications-apis/sms/">Vonnage</a> for SMS alerts. It you do not have an SMS account with Vonnage, then leave the Nexmo variables alone. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a> <a href="#fnref:1:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p>
    </li>
  </ol>
</div>
